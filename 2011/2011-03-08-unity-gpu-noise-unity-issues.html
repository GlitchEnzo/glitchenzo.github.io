<!DOCTYPE html> <html lang="en"><head>
<title>2011-03-08 - Unity GPU Noise  Unity Issues</title>
<base href="..">
<meta name="pathname" content="2011/2011-03-08-unity-gpu-noise-unity-issues.html">
<meta name="description" content="Trick McCarthy's Blog - 2011-03-08 - Unity GPU Noise  Unity Issues">
<meta property="og:title" content="2011-03-08 - Unity GPU Noise  Unity Issues">
<meta property="og:description" content="Trick McCarthy's Blog - 2011-03-08 - Unity GPU Noise  Unity Issues">
<meta property="og:type" content="website">
<meta property="og:url" content="https://glitchenzo.github.io/2011/2011-03-08-unity-gpu-noise-unity-issues.html">
<meta property="og:image" content="http://1.bp.blogspot.com/-hpkESpl8vWE/TXavIQlzvAI/AAAAAAAAFlA/lDE24WNJ7Ds/s400/noise.png">
<meta name="author" content="Patrick McCarthy"><meta charset="UTF-8"><meta property="og:site_name" content="Trick McCarthy's Blog"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://glitchenzo.github.io/site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager styled-scrollbars show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="2011-03-08_-_Unity_GPU_Noise_Unity_Issues_0">2011-03-08 - Unity GPU Noise  Unity Issues</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h1"><h1 data-heading="Unity GPU Noise &amp; Unity Issues" dir="auto" class="heading" id="Unity_GPU_Noise_&amp;_Unity_Issues_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Unity GPU Noise &amp; Unity Issues</h1></div><div class="el-p"><p dir="auto"><strong><em>2011-03-08</em></strong></p></div><div class="el-p"><p dir="auto">It's amazing how much time keeps slipping by without any posts.  Another 5 months have somehow passed since my last post.  That means that I have only written 2 posts in the past year!  I need to get back to my good update schedule.  </p></div><div class="el-p"><p dir="auto">GPU Noise in Unity  </p></div><div class="el-p"><p dir="auto">First, I'd like to show a simple demo I made of various types of noise on the GPU in Unity.  You can check out the live demo on the web by clicking on the image below.  You need to have a Shader Model 3.0 GPU in order to run the demo.  </p></div><div class="el-p"><p dir="auto"><a data-tooltip-position="top" aria-label="http://re-creationstudios.com/unity/noise/" rel="noopener nofollow" class="external-link is-unresolved" href="http://re-creationstudios.com/unity/noise/" target="_self"><img src="http://1.bp.blogspot.com/-hpkESpl8vWE/TXavIQlzvAI/AAAAAAAAFlA/lDE24WNJ7Ds/s400/noise.png" referrerpolicy="no-referrer" target="_self" class="is-unresolved"></a>  </p></div><div class="el-p"><p dir="auto">As you can see, there are 9 different types of noise in the demo and they are all implemented in Cg shaders on the GPU.  </p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://en.wikipedia.org/wiki/Perlin_noise" rel="noopener nofollow" class="external-link is-unresolved" href="http://en.wikipedia.org/wiki/Perlin_noise" target="_self">Perlin</a></em> - "Standard" Perlin Noise (1 octave)</li>
<li data-line="1" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://en.wikipedia.org/wiki/Fractional_Brownian_motion" rel="noopener nofollow" class="external-link is-unresolved" href="http://en.wikipedia.org/wiki/Fractional_Brownian_motion" target="_self">fBm</a></em> - fractional Brownian motion summation of Perlin Noise (8 octaves)</li>
<li data-line="2" dir="auto"><span class="list-bullet"></span><em>Turbulence</em> - fBm variation that sums the absolute value of the noise result (8 octaves)</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><em>Ridged</em> - fBm variation from the book "Texturing and Modeling: A Procedural Approach" that performs a special ridge function on the noise result (8 octaves)</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span><a data-tooltip-position="top" aria-label="http://en.wikipedia.org/wiki/Voronoi_diagram" rel="noopener nofollow" class="external-link is-unresolved" href="http://en.wikipedia.org/wiki/Voronoi_diagram" target="_self"><em>Voronoi</em></a> (F1) - A "noise" type that uses a field of random 3D points and determines the distance to the closest point</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span><em>F2</em> - Voronoi that determines the distance to the <em>second</em>closest point</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span><em>F2 - F1</em> - Voronoi that determines the difference between the first and second closest points</li>
<li data-line="7" dir="auto"><span class="list-bullet"></span><em>(F1 + F2) / 2</em> - Voronoi that averages the distance between the two closest points</li>
<li data-line="8" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://www.gamedev.net/blog/73/entry-1832259-gpu-terrain-generation-cell-noise-rivers-crater/" rel="noopener nofollow" class="external-link is-unresolved" href="http://www.gamedev.net/blog/73/entry-1832259-gpu-terrain-generation-cell-noise-rivers-crater/" target="_self">Crater</a></em> - Voronoi variation that makes crater-like structures</li>
</ul></div><div class="el-p"><p dir="auto">Have fun messing around with the sliders and seeing how the noise can be manipulated on the fly!  </p></div><div class="el-p"><p dir="auto"><strong>Unity Issues</strong></p></div><div class="el-p"><p dir="auto">After completing the GPU noise demo in Unity (it's actually been done since November), I started proceeding with implementing a procedural planet generator in Unity.  It quickly introduced me to some of the issues and limitations that Unity has.</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://answers.unity3d.com/questions/29948/disable-frustum-culling" rel="noopener nofollow" class="external-link is-unresolved" href="http://answers.unity3d.com/questions/29948/disable-frustum-culling" target="_self">Cannot disable/control view frustum culling</a></em>.<br>
This is the worst issue I ran into.  The way I implement the planet is to have a small cube that is "blown out" to form a sphere and then offset with noise all on the GPU (Ã  la displacement mapping).  Unity has a camera system that determines which objects are inside each camera's view frustum and automatically culls (doesn't draw) any objects that are outside of the view frustum.  The problem is, while the small cube is not in the view frustum, the final displaced planet <strong>is</strong> in the frustum.  This causes the planet to suddenly stop rendering if the camera is pointed a certain direction.  </li>
</ul></div><div class="el-p"><p dir="auto">I tried several fixes such as blowing the cube up to be the same size of the planet and forcing the view angle to be the maximum value (179 degrees) when Unity does the frustum check.  Neither of these got rid of the problem entirely and just reduced how much it happened.  In order to fix it, game developers should have control over which objects should be culled, or be able to disable frustum culling entirely.</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://answers.unity3d.com/questions/30420/run-script-in-edit-mode-when-paused" rel="noopener nofollow" class="external-link is-unresolved" href="http://answers.unity3d.com/questions/30420/run-script-in-edit-mode-when-paused" target="_self">Cannot run editor scripts when paused</a></em>.<br>
This problem stems from another problem in Unity.  Unity doesn't send the View matrix (by design) or Projection matrix (current bug) to the shaders, so you need a script to send them manually.  Because of this, you need to have this script continually updating the shader variables even when the game is paused.  If they are not updated then the objects render in the same place on the screen no matter where you move the camera.  This is a horrible problem with no real fix.</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://answers.unity3d.com/questions/30357/create-a-custom-collider" rel="noopener nofollow" class="external-link is-unresolved" href="http://answers.unity3d.com/questions/30357/create-a-custom-collider" target="_self">Cannot create a custom collider</a></em>.<br>
Unity provides no simple way to create your own physics collider object.  You can inherit from their built-in Collider class, but you cannot override any methods inside of it.  As you can see from the link, I came up with a work-around for what I specifically was trying to accomplish: make a spherical planet collider.  It is very similar to what I did in Bullet in the past.</li>
<li data-line="6" dir="auto"><span class="list-bullet"></span><em><a data-tooltip-position="top" aria-label="http://forum.unity3d.com/threads/66153-Writing-depth-value-in-fragment-program" rel="noopener nofollow" class="external-link is-unresolved" href="http://forum.unity3d.com/threads/66153-Writing-depth-value-in-fragment-program" target="_self">Cannot write depth in pixel shader</a></em>. (<a data-tooltip-position="top" aria-label="http://www.ogre3d.org/forums/viewtopic.php?p=274238" rel="noopener nofollow" class="external-link is-unresolved" href="http://www.ogre3d.org/forums/viewtopic.php?p=274238" target="_self">Also explained here</a>.)<br>
I tried implementing a logarithmic depth buffer, but I was greeted with a Cg compilation error when trying to write to the depth register.  This is actually a bug in the Cg compiler.  It's been fixed in the compiler, but Unity is still using an old version of the compiler which has the bug. I need to test the latest releases of Unity to see if this is still a problem.</li>
</ul></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="2011/2011-03-08-unity-gpu-noise-unity-issues.html#2011-03-08_-_Unity_GPU_Noise_Unity_Issues_0" data-path="#2011-03-08_-_Unity_GPU_Noise_Unity_Issues_0"><div class="tree-item-inner heading-link" heading-name="2011-03-08 - Unity GPU Noise  Unity Issues">2011-03-08 - Unity GPU Noise  Unity Issues</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="2011/2011-03-08-unity-gpu-noise-unity-issues.html#Unity_GPU_Noise_&amp;_Unity_Issues_0" data-path="#Unity_GPU_Noise_&amp;_Unity_Issues_0"><div class="tree-item-inner heading-link" heading-name="Unity GPU Noise &amp; Unity Issues">Unity GPU Noise &amp; Unity Issues</div></a><div class="tree-item-children"></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>